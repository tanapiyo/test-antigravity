# Project Galaxy - アーキテクチャ & 実装計画

## 1. 技術スタック提案

### フロントエンド (Web Client)
*   **フレームワーク**: **React 18** + **TypeScript** (高速な **Vite** を使用)。
*   **状態管理**: **Zustand** (軽量で使いやすい)。
*   **スタイリング**: **Vanilla CSS** (CSS Variablesでテーマ管理) + **CSS Modules** (コンポーネント分離)。「プレミアム」な美学（グラスモーフィズム、スムーズなトランジション）を重視。
*   **リアルタイム通信**: **Socket.io-client** (チャット/シグナリング)。
*   **音声/ビデオ**: **WebRTC** (Native API) + **Simple-Peer** (メッシュネットワーク構築の簡易化)。
*   **仮想空間**: **HTML5 Canvas** (パフォーマンス重視の独自実装) または **React-Konva**。

### バックエンド (API & Signaling)
*   **ランタイム**: **Node.js** + **TypeScript**。
*   **フレームワーク**: **Express** (堅牢でエコシステムが巨大)。
*   **リアルタイムエンジン**: **Socket.io** (チャット、アバター移動、WebRTCシグナリングのイベント処理)。
*   **データベース**: MVP用に **SQLite** (**Prisma ORM** 経由)。後でPostgreSQLへの移行が容易。
*   **ストレージ**: ローカルファイルストレージ (MVP用)。

### インフラストラクチャ
*   **コンテナ化**: Docker (MVPのローカル開発では任意)。
*   **CI/CD**: GitHub Actions (Linting, Testing)。

## 2. ハイレベルタスク分解

### フェーズ 1: 基盤構築 & セットアップ
1.  **プロジェクト初期化**: モノレポ構成のセットアップ (client/server)。
2.  **デザインシステム**: 「Galaxy」テーマのCSS変数（色、スペーシング、タイポグラフィ）を定義。
3.  **バックエンドスケルトン**: Express + Socket.io サーバーのセットアップ。

### フェーズ 2: コアモジュール (MVP)

#### モジュール A: 認証 & ユーザープロファイル
*   ログイン/サインアップの実装 (JWTベース)。
*   ユーザープロファイル (アバター選択、ステータス)。

#### モジュール B: バーチャルワークスペース (メタバース)
*   **キャンバスグリッド**: 2Dタイルベースのマップを描画。
*   **アバターシステム**: ユーザーをマップ上に描画。
*   **移動同期**: Socket.io経由で座標をブロードキャスト。

#### モジュール C: コミュニケーションレイヤー
*   **テキストチャット**:
    *   チャンネルUI (サイドバー)。
    *   メッセージストリーム (リアルタイム更新)。
*   **ボイスチャット (空間オーディオ)**:
    *   WebRTC シグナリングの実装。
    *   距離計算: `Volume = max(0, 1 - distance / max_distance)`。

### フェーズ 3: 統合 & 仕上げ
1.  **UIの洗練**: アニメーション、ホバーエフェクト、ダークモードの磨き上げ。
2.  **パフォーマンスチューニング**: キャンバス描画とソケットイベントの間引き(throttling)を最適化。
3.  **デプロイ**: ビルドスクリプトのセットアップ。

## 3. 開発ワークフロー
1.  **計画**: 特定のモジュールの要件を確認。
2.  **モックアップ**: 簡単なUIワイヤーフレームを作成（脳内またはコード）。
3.  **コーディング**: フロントエンドとバックエンドを並行して実装。
4.  **検証**: 機能の手動テスト。
